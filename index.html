<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Composeon AI - Smart Icon Discovery with Local AI</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <style>
        :root {
            /* Modern Dark Theme */
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --bg-glass: rgba(22, 27, 34, 0.8);
            --bg-card: rgba(33, 38, 45, 0.6);
            --bg-hover: rgba(56, 139, 253, 0.1);

            /* Text Colors */
            --text-primary: #f0f6fc;
            --text-secondary: #7d8590;
            --text-muted: #656d76;
            --text-accent: #58a6ff;

            /* Accent Colors */
            --accent-blue: #58a6ff;
            --accent-purple: #a5a1ff;
            --accent-green: #3fb950;
            --accent-orange: #fd7e14;
            --accent-red: #f85149;

            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #58a6ff 0%, #a5a1ff 100%);
            --gradient-secondary: linear-gradient(135deg, #21262d 0%, #30363d 100%);

            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            --shadow-glow: 0 0 20px rgba(88, 166, 255, 0.3);

            /* Spacing */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-12: 3rem;

            /* Border Radius */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;

            /* Font */
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            height: 100vh;
        }

        /* Header */
        .header {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--bg-tertiary);
            padding: var(--space-4);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo i {
            color: var(--accent-blue);
            -webkit-text-fill-color: initial;
        }

        .header-stats {
            display: flex;
            gap: var(--space-6);
            align-items: center;
        }

        .stat-item {
            text-align: center;
            padding: var(--space-2) var(--space-4);
            background: var(--bg-card);
            border-radius: var(--radius-md);
            border: 1px solid var(--bg-tertiary);
        }

        .stat-number {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--accent-blue);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: var(--space-1);
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 400px 1fr;
            height: calc(100vh - 80px);
            max-width: 1400px;
            margin: 0 auto;
            gap: 0;
        }

        /* Left Panel - AI Search */
        .ai-panel {
            background: var(--bg-secondary);
            border-right: 1px solid var(--bg-tertiary);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .ai-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--bg-tertiary);
        }

        .ai-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .ai-subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .search-container {
            padding: var(--space-6);
            border-bottom: 1px solid var(--bg-tertiary);
        }

        .search-input-group {
            position: relative;
            margin-bottom: var(--space-4);
        }

        .search-input {
            width: 100%;
            padding: var(--space-4) var(--space-4) var(--space-4) 3rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--bg-tertiary);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .search-icon {
            position: absolute;
            left: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .ai-toggle {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .toggle-switch.active {
            background: var(--accent-blue);
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 10px;
            transition: transform 0.2s ease;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(20px);
        }

        .toggle-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* AI Response Area */
        .ai-response {
            flex: 1;
            padding: var(--space-6);
            overflow-y: auto;
        }

        .ai-message {
            background: var(--bg-card);
            border: 1px solid var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-4);
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .ai-message.loading {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .loading-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid var(--bg-tertiary);
            border-top: 2px solid var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .ai-suggestions {
            margin-top: var(--space-4);
        }

        .suggestion-chip {
            display: inline-block;
            background: var(--bg-tertiary);
            border: 1px solid var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: var(--space-2) var(--space-3);
            margin: var(--space-1);
            font-size: 0.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .suggestion-chip:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--accent-blue);
        }

        /* Right Panel - Icons */
        .icons-panel {
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .icons-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--bg-tertiary);
        }

        .icons-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .filter-chips {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
            margin-top: var(--space-4);
        }

        .filter-chip {
            background: var(--bg-card);
            border: 1px solid var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: var(--space-2) var(--space-3);
            font-size: 0.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .filter-chip:hover,
        .filter-chip.active {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--accent-blue);
        }

        /* Icons Grid */
        .icons-content {
            flex: 1;
            padding: var(--space-6);
            overflow-y: auto;
            position: relative;
        }

        .icons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-8);
        }

        .icon-card {
            background: var(--bg-card);
            border: 1px solid var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-3);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            aspect-ratio: 1;
        }

        .icon-card:hover {
            background: var(--bg-hover);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .icon-card.selected {
            background: var(--bg-hover);
            border-color: var(--accent-blue);
            box-shadow: var(--shadow-glow);
        }

        .icon-card img {
            width: 48px;
            height: 48px;
            object-fit: contain;
            filter: brightness(0.9);
            transition: all 0.2s ease;
        }

        .icon-card:hover img,
        .icon-card.selected img {
            filter: brightness(1);
            transform: scale(1.1);
        }

        .icon-name {
            font-size: 0.75rem;
            font-weight: 500;
            text-align: center;
            color: var(--text-secondary);
            text-transform: capitalize;
        }

        .icon-card:hover .icon-name,
        .icon-card.selected .icon-name {
            color: var(--text-primary);
        }

        .selection-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background: var(--accent-green);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            opacity: 0;
            transform: scale(0);
            transition: all 0.2s ease;
        }

        .icon-card.selected .selection-badge {
            opacity: 1;
            transform: scale(1);
        }

        /* Load More Button */
        .load-more {
            text-align: center;
            padding: var(--space-6);
        }

        .load-more-btn {
            background: var(--bg-card);
            border: 1px solid var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--space-4) var(--space-8);
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin: 0 auto;
        }

        .load-more-btn:hover {
            background: var(--bg-hover);
            border-color: var(--accent-blue);
            transform: translateY(-1px);
        }

        .load-more-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-12);
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: var(--space-4);
            opacity: 0.5;
        }

        /* Floating Action Panel */
        .action-panel {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--bg-tertiary);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            box-shadow: var(--shadow-lg);
            display: flex;
            gap: var(--space-3);
            align-items: center;
            opacity: 0;
            transform: translateY(100px);
            transition: all 0.3s ease;
        }

        .action-panel.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .action-btn {
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--radius-md);
            padding: var(--space-3) var(--space-6);
            color: white;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .action-btn.secondary {
            background: var(--bg-card);
            border: 1px solid var(--bg-tertiary);
        }

        /* Animations */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-layout {
                grid-template-columns: 1fr;
                grid-template-rows: 50vh 1fr;
            }

            .ai-panel {
                border-right: none;
                border-bottom: 1px solid var(--bg-tertiary);
            }

            .header-stats {
                display: none;
            }
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--space-3);
            max-width: 350px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-icon {
            color: var(--accent-green);
        }

        .toast-message {
            font-size: 0.875rem;
        }

        /* Ollama Status */
        .ollama-status {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-top: var(--space-4);
            padding: var(--space-3);
            background: var(--bg-card);
            border-radius: var(--radius-md);
            font-size: 0.75rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
        }

        .status-dot.offline {
            background: var(--accent-red);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-cube"></i>
                Composeon AI
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalIcons">760+</div>
                    <div class="stat-label">Icons Available</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="loadedIcons">0</div>
                    <div class="stat-label">Currently Loaded</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="selectedCount">0</div>
                    <div class="stat-label">Selected</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Left Panel - AI Search -->
        <div class="ai-panel">
            <div class="ai-header">
                <h2 class="ai-title">
                    <i class="fas fa-brain"></i>
                    AI-Powered Search
                </h2>
                <p class="ai-subtitle">Ask me about icons, companies, or technologies</p>
            </div>

            <div class="search-container">
                <div class="search-input-group">
                    <input
                        type="text"
                        class="search-input"
                        id="aiSearchInput"
                        placeholder="What icons are you looking for?"
                        autocomplete="off"
                    >
                    <i class="fas fa-search search-icon"></i>
                </div>

                <div class="ai-toggle">
                    <div class="toggle-switch" id="aiToggle">
                        <div class="toggle-slider"></div>
                    </div>
                    <span class="toggle-label">AI-Enhanced Search</span>
                </div>

                <div class="ollama-status" id="ollamaStatus">
                    <div class="status-dot offline" id="statusDot"></div>
                    <span id="statusText">Connecting to Ollama...</span>
                </div>
            </div>

            <div class="ai-response" id="aiResponse">
                <div class="ai-message">
                    <p></p>ðŸ‘‹ Welcome to Composeon AI!</p>
                    <p>I can help you find the perfect icons. Try asking:</p>
                    <div class="ai-suggestions">
                        <span class="suggestion-chip" onclick="askAI('Show me AI company icons')">AI companies</span>
                        <span class="suggestion-chip" onclick="askAI('Find cloud provider logos')">Cloud providers</span>
                        <span class="suggestion-chip" onclick="askAI('Development tools icons')">Dev tools</span>
                        <span class="suggestion-chip" onclick="askAI('Social media platforms')">Social platforms</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel - Icons -->
        <div class="icons-panel">
            <div class="icons-header">
                <h2 class="icons-title">
                    <i class="fas fa-th-large"></i>
                    Icon Repository
                </h2>
                <div class="filter-chips">
                    <div class="filter-chip active" data-category="all">
                        <i class="fas fa-th"></i>
                        All
                    </div>
                    <div class="filter-chip" data-category="ai">
                        <i class="fas fa-robot"></i>
                        AI
                    </div>
                    <div class="filter-chip" data-category="cloud">
                        <i class="fas fa-cloud"></i>
                        Cloud
                    </div>
                    <div class="filter-chip" data-category="dev">
                        <i class="fas fa-code"></i>
                        Dev
                    </div>
                    <div class="filter-chip" data-category="design">
                        <i class="fas fa-palette"></i>
                        Design
                    </div>
                    <div class="filter-chip" data-category="social">
                        <i class="fas fa-users"></i>
                        Social
                    </div>
                </div>
            </div>

            <div class="icons-content">
                <div class="icons-grid" id="iconsGrid">
                    <!-- Icons will be loaded here -->
                </div>

                <div class="load-more" id="loadMoreSection">
                    <button class="load-more-btn" id="loadMoreBtn" onclick="loadMoreIcons()">
                        <i class="fas fa-plus"></i>
                        Load More Icons
                    </button>
                </div>

                <div class="empty-state" id="emptyState" style="display: none;">
                    <i class="fas fa-search"></i>
                    <h3>No icons found</h3>
                    <p>Try adjusting your search or ask the AI for help</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Panel -->
    <div class="action-panel" id="actionPanel">
        <span id="selectionCount">0 selected</span>
        <button class="action-btn secondary" onclick="clearSelection()">
            <i class="fas fa-times"></i>
            Clear
        </button>
        <button class="action-btn" onclick="generatePost()">
            <i class="fas fa-magic"></i>
            Generate Post
        </button>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle toast-icon"></i>
        <span class="toast-message" id="toastMessage"></span>
    </div>

    <!-- Scripts -->
    <script>
        // Global State
        let icons = [];
        let displayedIcons = [];
        let selectedIcons = new Set();
        let currentCategory = 'all';
        let iconsPerPage = 24;
        let currentPage = 0;
        let isAIEnabled = false;
        let ollamaConnected = false;

        // Categories mapping for better organization
        const categoryMapping = {
            ai: ['openai', 'claude', 'anthropic', 'gemini', 'chatgpt', 'deepseek', 'cohere', 'huggingface', 'replicate'],
            cloud: ['aws', 'azure', 'google', 'googlecloud', 'digitalocean', 'cloudflare', 'heroku', 'netlify', 'vercel'],
            dev: ['github', 'gitlab', 'vscode', 'cursor', 'docker', 'kubernetes', 'jenkins', 'react', 'nodejs', 'python'],
            design: ['figma', 'adobe', 'sketch', 'canva', 'framer', 'invision', 'dribbble', 'behance'],
            social: ['linkedin', 'twitter', 'facebook', 'instagram', 'youtube', 'tiktok', 'discord', 'slack'],
            database: ['mongodb', 'postgresql', 'mysql', 'redis', 'elasticsearch', 'snowflake'],
            crypto: ['bitcoin', 'ethereum', 'binance', 'coinbase'],
            browser: ['chrome', 'firefox', 'safari', 'edge', 'opera', 'brave']
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeApp();
            setupEventListeners();
            checkOllamaConnection();
        });

        async function initializeApp() {
            showToast('ðŸš€ Loading icons...', 2000);

            // Load initial batch of icons
            await loadIconsList();
            loadMoreIcons();

            console.log(`ðŸ“Š Composeon AI initialized with ${icons.length} total icons`);
        }

        async function loadIconsList() {
            try {
                // Try to load from directory scan or manifest
                const response = await fetch('./icons-manifest.json').catch(() => null);

                if (response && response.ok) {
                    const data = await response.json();
                    icons = data.icons || [];
                } else {
                    // Fallback to known icons list
                    icons = generateKnownIconsList();
                }

                updateStats();
                showToast(`âœ… ${icons.length} icons ready to explore`, 3000);
            } catch (error) {
                console.error('Failed to load icons:', error);
                icons = generateFallbackIcons();
                showToast('âš ï¸ Using fallback icon set', 3000);
            }
        }

        function generateKnownIconsList() {
            const knownIcons = [];

            // Popular tech companies and tools
            const techIcons = [
                // AI/ML Companies
                'openai', 'claude', 'anthropic', 'gemini', 'chatgpt', 'midjourney', 'stability', 'huggingface',
                'deepseek', 'cohere', 'replicate', 'runway', 'perplexity', 'character',

                // Cloud Providers
                'aws', 'azure', 'google', 'googlecloud', 'digitalocean', 'cloudflare', 'heroku',
                'netlify', 'vercel', 'railway', 'render', 'supabase', 'planetscale',

                // Development Tools
                'github', 'gitlab', 'bitbucket', 'vscode', 'cursor', 'jetbrains', 'sublime',
                'docker', 'kubernetes', 'jenkins', 'circleci', 'travis',

                // Programming Languages & Frameworks
                'react', 'vue', 'angular', 'svelte', 'nextjs', 'nuxt', 'gatsby',
                'nodejs', 'python', 'javascript', 'typescript', 'java', 'golang', 'rust',
                'php', 'ruby', 'swift', 'kotlin', 'dart', 'flutter',

                // Design Tools
                'figma', 'adobe', 'sketch', 'canva', 'framer', 'invision', 'principle',
                'dribbble', 'behance', 'unsplash', 'pexels',

                // Social Platforms
                'linkedin', 'twitter', 'facebook', 'instagram', 'youtube', 'tiktok',
                'discord', 'slack', 'telegram', 'whatsapp', 'zoom', 'teams',

                // Databases
                'mongodb', 'postgresql', 'mysql', 'redis', 'elasticsearch', 'cassandra',
                'neo4j', 'sqlite', 'snowflake', 'databricks',

                // Browsers
                'chrome', 'firefox', 'safari', 'edge', 'opera', 'brave',

                // Crypto
                'bitcoin', 'ethereum', 'binance', 'coinbase', 'metamask',

                // E-commerce & Payments
                'shopify', 'stripe', 'paypal', 'square', 'klarna'
            ];

            return techIcons.map(name => ({
                name,
                displayName: formatDisplayName(name),
                category: getIconCategory(name),
                path: `lobe-icons/packages/static-svg/icons/${name}.svg`
            }));
        }

        function generateFallbackIcons() {
            return [
                { name: 'openai', displayName: 'OpenAI', category: 'ai', path: 'lobe-icons/packages/static-svg/icons/openai.svg' },
                { name: 'github', displayName: 'GitHub', category: 'dev', path: 'lobe-icons/packages/static-svg/icons/github.svg' },
                { name: 'figma', displayName: 'Figma', category: 'design', path: 'lobe-icons/packages/static-svg/icons/figma.svg' },
                { name: 'aws', displayName: 'AWS', category: 'cloud', path: 'lobe-icons/packages/static-svg/icons/aws.svg' },
                { name: 'linkedin', displayName: 'LinkedIn', category: 'social', path: 'lobe-icons/packages/static-svg/icons/linkedin.svg' }
            ];
        }

        function formatDisplayName(name) {
            const specialNames = {
                'openai': 'OpenAI',
                'github': 'GitHub',
                'vscode': 'VS Code',
                'nodejs': 'Node.js',
                'nextjs': 'Next.js',
                'typescript': 'TypeScript',
                'javascript': 'JavaScript',
                'mongodb': 'MongoDB',
                'postgresql': 'PostgreSQL',
                'mysql': 'MySQL',
                'aws': 'AWS',
                'gcp': 'Google Cloud'
            };

            return specialNames[name] || name.charAt(0).toUpperCase() + name.slice(1);
        }

        function getIconCategory(name) {
            for (const [category, iconNames] of Object.entries(categoryMapping)) {
                if (iconNames.includes(name)) {
                    return category;
                }
            }
            return 'other';
        }

        function setupEventListeners() {
            // AI Search
            const aiSearchInput = document.getElementById('aiSearchInput');
            let searchTimeout;
            aiSearchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => handleAISearch(e.target.value), 500);
            });

            // AI Toggle
            document.getElementById('aiToggle').addEventListener('click', toggleAI);

            // Filter chips
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.addEventListener('click', () => handleCategoryFilter(chip));
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
        }

        function handleAISearch(query) {
            if (!query.trim()) {
                resetToDefault();
                return;
            }

            if (isAIEnabled && ollamaConnected) {
                processAIQuery(query);
            } else {
                processBasicSearch(query);
            }
        }

        function processBasicSearch(query) {
            const filtered = icons.filter(icon =>
                icon.name.toLowerCase().includes(query.toLowerCase()) ||
                icon.displayName.toLowerCase().includes(query.toLowerCase())
            );

            displayIcons(filtered.slice(0, iconsPerPage));
            updateStats();

            // Update AI response
            const response = document.getElementById('aiResponse');
            response.innerHTML = `
                <div class="ai-message">
                    <p>ðŸ“Š Found <strong>${filtered.length}</strong> icons matching "<strong>${query}</strong>"</p>
                    ${filtered.length > iconsPerPage ? `<p><small>Showing first ${iconsPerPage} results. Use "Load More" to see more.</small></p>` : ''}
                </div>
            `;
        }

        async function processAIQuery(query) {
            const response = document.getElementById('aiResponse');

            // Show loading
            response.innerHTML = `
                <div class="ai-message loading">
                    <div class="loading-spinner"></div>
                    <span>Thinking...</span>
                </div>
            `;

            try {
                const aiResponse = await queryOllama(query);
                const relevantIcons = extractIconsFromAIResponse(aiResponse, query);

                displayIcons(relevantIcons.slice(0, iconsPerPage));

                response.innerHTML = `
                    <div class="ai-message">
                        <p>${aiResponse}</p>
                        <div class="ai-suggestions">
                            <span class="suggestion-chip" onclick="askAI('Show me more ${getCurrentCategory()} tools')">More ${getCurrentCategory()}</span>
                            <span class="suggestion-chip" onclick="askAI('Alternative tools to ${query}')">Alternatives</span>
                            <span class="suggestion-chip" onclick="askAI('Popular tools in this category')">Popular tools</span>
                        </div>
                    </div>
                `;

                updateStats();
            } catch (error) {
                console.error('AI query failed:', error);
                processBasicSearch(query);
            }
        }

        async function queryOllama(query) {
            try {
                const response = await fetch('http://localhost:11434/api/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'llama3.2',
                        prompt: `You are an expert in technology companies and tools. A user is searching for icons with this query: "${query}".

Available categories: AI, Cloud, Development, Design, Social, Database, Browser, Crypto, E-commerce.

Respond with a helpful explanation of what icons they might be looking for, and suggest 3-5 specific company/tool names that match their query. Be concise and helpful.

Response format: Start with a brief explanation, then list the most relevant tools/companies.`,
                        stream: false
                    })
                });

                if (!response.ok) throw new Error('Ollama request failed');

                const data = await response.json();
                return data.response;
            } catch (error) {
                console.error('Ollama query error:', error);
                throw error;
            }
        }

        function extractIconsFromAIResponse(aiResponse, originalQuery) {
            // Extract mentioned company/tool names and find matching icons
            const mentioned = [];
            const words = aiResponse.toLowerCase().split(/\s+/);

            icons.forEach(icon => {
                if (words.some(word =>
                    word.includes(icon.name.toLowerCase()) ||
                    icon.name.toLowerCase().includes(word) ||
                    icon.displayName.toLowerCase().includes(originalQuery.toLowerCase())
                )) {
                    mentioned.push(icon);
                }
            });

            // Fallback to basic search if AI didn't mention specific tools
            if (mentioned.length === 0) {
                return icons.filter(icon =>
                    icon.name.toLowerCase().includes(originalQuery.toLowerCase()) ||
                    icon.displayName.toLowerCase().includes(originalQuery.toLowerCase())
                );
            }

            return mentioned;
        }

        function askAI(question) {
            document.getElementById('aiSearchInput').value = question;
            handleAISearch(question);
        }

        async function checkOllamaConnection() {
            try {
                const response = await fetch('http://localhost:11434/api/tags', {
                    method: 'GET',
                    signal: AbortSignal.timeout(3000)
                });

                if (response.ok) {
                    ollamaConnected = true;
                    updateOllamaStatus(true, 'Connected to Ollama');
                } else {
                    updateOllamaStatus(false, 'Ollama not responding');
                }
            } catch (error) {
                updateOllamaStatus(false, 'Ollama not available');
            }
        }

        function updateOllamaStatus(connected, message) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');

            ollamaConnected = connected;
            statusDot.className = `status-dot ${connected ? '' : 'offline'}`;
            statusText.textContent = message;

            // Auto-enable AI if Ollama is connected
            if (connected && !isAIEnabled) {
                document.getElementById('aiToggle').click();
            }
        }

        function toggleAI() {
            const toggle = document.getElementById('aiToggle');
            isAIEnabled = !isAIEnabled;
            toggle.classList.toggle('active');

            if (isAIEnabled && !ollamaConnected) {
                showToast('âš ï¸ AI enabled but Ollama not connected', 3000);
            } else if (isAIEnabled) {
                showToast('ðŸ§  AI-enhanced search enabled', 2000);
            } else {
                showToast('ðŸ” Basic search mode', 2000);
            }
        }

        function handleCategoryFilter(clickedChip) {
            // Update active filter
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            clickedChip.classList.add('active');

            const category = clickedChip.dataset.category;
            currentCategory = category;
            currentPage = 0;

            // Filter icons
            const filtered = category === 'all'
                ? icons
                : icons.filter(icon => icon.category === category);

            displayIcons(filtered.slice(0, iconsPerPage));
            updateLoadMoreButton(filtered.length);
            updateStats();

            // Clear search
            document.getElementById('aiSearchInput').value = '';
        }

        function loadMoreIcons() {
            currentPage++;
            const startIndex = currentPage * iconsPerPage;
            const filtered = getFilteredIcons();
            const newIcons = filtered.slice(startIndex, startIndex + iconsPerPage);

            if (newIcons.length > 0) {
                appendIcons(newIcons);
                updateLoadMoreButton(filtered.length);
                updateStats();
            }
        }

        function getFilteredIcons() {
            return currentCategory === 'all'
                ? icons
                : icons.filter(icon => icon.category === currentCategory);
        }

        function displayIcons(iconsToShow) {
            const grid = document.getElementById('iconsGrid');
            const emptyState = document.getElementById('emptyState');

            if (iconsToShow.length === 0) {
                grid.innerHTML = '';
                emptyState.style.display = 'flex';
                return;
            }

            emptyState.style.display = 'none';
            grid.innerHTML = '';
            displayedIcons = [...iconsToShow];

            iconsToShow.forEach((icon, index) => {
                const card = createIconCard(icon, index);
                grid.appendChild(card);
            });

            updateLoadMoreButton(getFilteredIcons().length);
        }

        function appendIcons(newIcons) {
            const grid = document.getElementById('iconsGrid');
            const startIndex = displayedIcons.length;

            newIcons.forEach((icon, index) => {
                const card = createIconCard(icon, startIndex + index);
                grid.appendChild(card);
                displayedIcons.push(icon);
            });
        }

        function createIconCard(icon, index) {
            const card = document.createElement('div');
            card.className = 'icon-card fade-in';
            card.dataset.iconName = icon.name;
            card.style.animationDelay = `${(index % 24) * 50}ms`;

            card.innerHTML = `
                <img src="${icon.path}" alt="${icon.name}" loading="lazy"
                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjQiIGN5PSIyNCIgcj0iMjQiIGZpbGw9IiMyMTI2MmQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4PSIxMiIgeT0iMTIiPgo8cGF0aCBkPSJNMTIgMkM2LjQ3NzE1IDIgMiA2LjQ3NzE1IDIgMTJDMiAxNy41MjI4IDYuNDc3MTUgMjIgMTIgMjJDMTcuNTIyOCAyMiAyMiAxNy41MjI4IDIyIDEyQzIyIDYuNDc3MTUgMTcuNTIyOCAyIDEyIDJaIiBmaWxsPSIjN2Q4NTkwIi8+Cjwvc3ZnPgo8L3N2Zz4K'">
                <div class="icon-name">${icon.displayName}</div>
                <div class="selection-badge">âœ“</div>
            `;

            card.addEventListener('click', () => toggleIconSelection(icon, card));

            if (selectedIcons.has(icon.name)) {
                card.classList.add('selected');
            }

            return card;
        }

        function toggleIconSelection(icon, card) {
            if (selectedIcons.has(icon.name)) {
                selectedIcons.delete(icon.name);
                card.classList.remove('selected');
            } else {
                selectedIcons.add(icon.name);
                card.classList.add('selected');
            }

            updateActionPanel();
            updateStats();
        }

        function updateActionPanel() {
            const panel = document.getElementById('actionPanel');
            const count = document.getElementById('selectionCount');

            if (selectedIcons.size > 0) {
                panel.classList.add('visible');
                count.textContent = `${selectedIcons.size} selected`;
            } else {
                panel.classList.remove('visible');
            }
        }

        function updateLoadMoreButton(totalFiltered) {
            const loadMoreSection = document.getElementById('loadMoreSection');
            const loadMoreBtn = document.getElementById('loadMoreBtn');

            const hasMore = displayedIcons.length < totalFiltered;

            if (hasMore) {
                loadMoreSection.style.display = 'block';
                loadMoreBtn.disabled = false;
                loadMoreBtn.innerHTML = `
                    <i class="fas fa-plus"></i>
                    Load More Icons (${totalFiltered - displayedIcons.length} remaining)
                `;
            } else if (displayedIcons.length > 0) {
                loadMoreSection.style.display = 'block';
                loadMoreBtn.disabled = true;
                loadMoreBtn.innerHTML = `
                    <i class="fas fa-check"></i>
                    All Icons Loaded
                `;
            } else {
                loadMoreSection.style.display = 'none';
            }
        }

        function updateStats() {
            document.getElementById('totalIcons').textContent = `${icons.length}+`;
            document.getElementById('loadedIcons').textContent = displayedIcons.length;
            document.getElementById('selectedCount').textContent = selectedIcons.size;
        }

        function resetToDefault() {
            currentPage = 0;
            currentCategory = 'all';

            // Reset filter chips
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            document.querySelector('.filter-chip[data-category="all"]').classList.add('active');

            // Display initial icons
            displayIcons(icons.slice(0, iconsPerPage));

            // Reset AI response
            const response = document.getElementById('aiResponse');
            response.innerHTML = `
                <div class="ai-message">
                    <p>ðŸ‘‹ Welcome back! I'm ready to help you find icons.</p>
                    <div class="ai-suggestions">
                        <span class="suggestion-chip" onclick="askAI('Show me popular AI tools')">AI tools</span>
                        <span class="suggestion-chip" onclick="askAI('Cloud platforms I should know')">Cloud platforms</span>
                        <span class="suggestion-chip" onclick="askAI('Essential dev tools')">Dev tools</span>
                        <span class="suggestion-chip" onclick="askAI('Design software icons')">Design tools</span>
                    </div>
                </div>
            `;
        }

        function getCurrentCategory() {
            return currentCategory === 'all' ? 'technology' : currentCategory;
        }

        function clearSelection() {
            selectedIcons.clear();
            document.querySelectorAll('.icon-card.selected').forEach(card => {
                card.classList.remove('selected');
            });
            updateActionPanel();
            updateStats();
            showToast('âœ¨ Selection cleared', 2000);
        }

        function generatePost() {
            if (selectedIcons.size === 0) {
                showToast('âš ï¸ Select some icons first!', 3000);
                return;
            }

            const selectedIconObjects = Array.from(selectedIcons).map(name =>
                icons.find(icon => icon.name === name)
            ).filter(Boolean);

            const iconList = selectedIconObjects
                .map(icon => `â€¢ ${icon.displayName}`)
                .join('\n');

            const post = `ðŸŒŸ Amazing tools that are transforming how we work:

${iconList}

These tools have revolutionized productivity and creativity in their respective domains. Each one brings unique capabilities that help teams and individuals achieve more.

What's your favorite tool from this list? Share your experience in the comments! ðŸ‘‡

#TechTools #Innovation #Productivity #TechStack`;

            // Copy to clipboard
            navigator.clipboard.writeText(post).then(() => {
                showToast('âœ… LinkedIn post copied to clipboard!', 3000);
            }).catch(() => {
                showToast('âŒ Failed to copy post', 3000);
            });
        }

        function handleKeyboardShortcuts(e) {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'k':
                        e.preventDefault();
                        document.getElementById('aiSearchInput').focus();
                        break;
                    case 'Enter':
                        if (selectedIcons.size > 0) {
                            e.preventDefault();
                            generatePost();
                        }
                        break;
                }
            }

            if (e.key === 'Escape') {
                clearSelection();
            }
        }

        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');

            toastMessage.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        // Auto-refresh Ollama connection every 30 seconds
        setInterval(checkOllamaConnection, 30000);
    </script>
</body>
</html>
